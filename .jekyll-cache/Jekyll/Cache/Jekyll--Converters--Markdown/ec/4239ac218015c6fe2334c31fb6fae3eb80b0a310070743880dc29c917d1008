I"<p><strong>Trong trang nÃ y:</strong>
<!-- MarkdownTOC --></p>

<ul>
  <li><a href="#-gioi-thieu">1. Giá»›i thiá»‡u</a></li>
  <li><a href="#-user-user-collaborative-filtering">2. User-user Collaborative Filtering</a>
    <ul>
      <li><a href="#-similarity-functions">2.1. Similarity functions</a></li>
      <li><a href="#-rating-prediction">2.2. Rating prediction</a></li>
    </ul>
  </li>
  <li><a href="#-item-item-collaborative-filtering">3. Item-item Collaborative Filtering</a></li>
  <li><a href="#-lap-trinh-collaborative-filtering-tren-python">4. Láº­p trÃ¬nh Collaborative Filtering trÃªn Python</a>
    <ul>
      <li><a href="#-class-cf">4.1. <code class="language-plaintext highlighter-rouge">class CF</code></a></li>
      <li><a href="#-ap-dung-vao-vi-du">4.2. Ãp dá»¥ng vÃ o vÃ­ dá»¥</a></li>
      <li><a href="#-ap-dung-len-movielens-k">4.3. Ãp dá»¥ng lÃªn MovieLens 100k</a></li>
    </ul>
  </li>
  <li><a href="#-thao-luan">5. Tháº£o luáº­n</a></li>
  <li><a href="#-tai-lieu-tham-khao">6. TÃ i liá»‡u tham kháº£o</a></li>
</ul>

<!-- /MarkdownTOC -->

<p><a name="-gioi-thieu"></a></p>

<h2 id="1-giá»›i-thiá»‡u">1. Giá»›i thiá»‡u</h2>

<p>Trong <a href="/2017/05/17/contentbasedrecommendersys/">Content-based Recommendation Systems</a>, chÃºng ta Ä‘Ã£ lÃ m quen vá»›i má»™t Há»‡ thá»‘ng gá»£i Ã½ sáº£n pháº©m Ä‘Æ¡n giáº£n dá»±a trÃªn Ä‘áº·c trÆ°ng cá»§a má»—i <em>item</em>. Äáº·c Ä‘iá»ƒm cá»§a Content-based Recommendation Systems lÃ  viá»‡c xÃ¢y dá»±ng mÃ´ hÃ¬nh cho má»—i <em>user</em> khÃ´ng phá»¥ thuá»™c vÃ o cÃ¡c <em>users</em> khÃ¡c mÃ  phá»¥ thuá»™c vÃ o <em>profile</em> cá»§a má»—i <em>items</em>. Viá»‡c lÃ m nÃ y cÃ³ lá»£i tháº¿ lÃ  tiáº¿t kiá»‡m bá»™ nhá»› vÃ  thá»i gian tÃ­nh toÃ¡n. Äá»“ng thá»i, há»‡ thá»‘ng cÃ³ kháº£ nÄƒng <em>táº­n dá»¥ng</em> cÃ¡c thÃ´ng tin Ä‘áº·c trÆ°ng cá»§a má»—i <em>item</em> nhÆ° Ä‘Æ°á»£c mÃ´ táº£ trong <em>báº£n mÃ´ táº£</em> (description) cá»§a má»—i <em>item</em>. <em>Báº£n mÃ´ táº£</em> nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c xÃ¢y dá»±ng bá»Ÿi nhÃ  cung cáº¥p hoáº·c Ä‘Æ°á»£c thu tháº­p báº±ng cÃ¡ch yÃªu cáº§u <em>users</em> gáº¯n <em>tags</em> cho <em>items</em>. Viá»‡c xÃ¢y dá»±ng <em>feature vector</em> cho má»—i <em>item</em> thÆ°á»ng bao gá»“m cÃ¡c ká»¹ thuáº­t Xá»­ lÃ½ ngÃ´n ngá»¯ tá»± nhiÃªn (Natural Language Processing - NLP).</p>

<p>CÃ¡ch lÃ m trÃªn cÃ³ hai nhÆ°á»£c Ä‘iá»ƒm cÆ¡ báº£n. <em>Thá»© nháº¥t</em>, khi xÃ¢y dá»±ng mÃ´ hÃ¬nh cho má»™t user, cÃ¡c há»‡ thá»‘ng Content-based khÃ´ng táº­n dá»¥ng Ä‘Æ°á»£c thÃ´ng tin tá»« cÃ¡c <em>users</em> khÃ¡c. Nhá»¯ng thÃ´ng tin nÃ y thÆ°á»ng ráº¥t há»¯u Ã­ch vÃ¬ hÃ nh vi mua hÃ ng cá»§a cÃ¡c <em>users</em> thÆ°á»ng Ä‘Æ°á»£c nhÃ³m thÃ nh má»™t vÃ i nhÃ³m Ä‘Æ¡n giáº£n; náº¿u biáº¿t hÃ nh vi mua hÃ ng cá»§a má»™t vÃ i <em>users</em> trong nhÃ³m, há»‡ thá»‘ng nÃªn <em>suy luáº­n</em> ra hÃ nh vi cá»§a nhá»¯ng <em>users</em> cÃ²n láº¡i. <em>Thá»© hai</em>, khÃ´ng pháº£i lÃºc nÃ o chÃºng ta cÅ©ng cÃ³ <em>báº£n mÃ´ táº£</em> cho má»—i <em>item</em>. Viá»‡c yÃªu cáº§u <em>users</em> gáº¯n <em>tags</em> cÃ²n khÃ³ khÄƒn hÆ¡n vÃ¬ khÃ´ng pháº£i ai cÅ©ng sáºµn sÃ ng lÃ m viá»‡c Ä‘Ã³; hoáº·c cÃ³ lÃ m nhÆ°ng sáº½ mang xu hÆ°á»›ng cÃ¡ nhÃ¢n. CÃ¡c thuáº­t toÃ¡n NLP cÅ©ng phá»©c táº¡p hÆ¡n á»Ÿ viá»‡c pháº£i xá»­ lÃ½ cÃ¡c tá»« gáº§n nghÄ©a, viáº¿t táº¯t, sai chÃ­nh táº£, hoáº·c Ä‘Æ°á»£c viáº¿t á»Ÿ cÃ¡c ngÃ´n ngá»¯ khÃ¡c nhau.</p>

<p>Nhá»¯ng nhÆ°á»£c Ä‘iá»ƒm phÃ­a trÃªn cÃ³ thá»ƒ Ä‘Æ°á»£c giáº£i quyáº¿t báº±ng <em>Collaborative Filtering</em> (CF). Trong bÃ i viáº¿t nÃ y, tÃ´i sáº½ trÃ¬nh bÃ y tá»›i cÃ¡c báº¡n má»™t phÆ°Æ¡ng phÃ¡p CF cÃ³ tÃªn lÃ  <em>Neighborhood-based Collaborative Filtering (NBCF)</em>. BÃ i tiáº¿p theo sáº½ trÃ¬nh bÃ y vá» má»™t phÆ°Æ¡ng phÃ¡p CF khÃ¡c cÃ³ tÃªn <em>Matrix Factorization Collaborative Filtering</em>. Khi chá»‰ nÃ³i Collaborative Filtering, chÃºng ta sáº½ ngáº§m hiá»ƒu ráº±ng phÆ°Æ¡ng phÃ¡p Ä‘Æ°á»£c sá»­ dá»¥ng lÃ  <em>Neighborhood-based</em>.</p>

<p>Ã tÆ°á»Ÿng cÆ¡ báº£n cá»§a NBCF lÃ  xÃ¡c Ä‘á»‹nh <em>má»©c Ä‘á»™ quan tÃ¢m</em> cá»§a má»™t <em>user</em> tá»›i má»™t <em>item</em> dá»±a trÃªn cÃ¡c <em>users</em> khÃ¡c <em>gáº§n giá»‘ng</em> vá»›i <em>user</em> nÃ y. Viá»‡c <em>gáº§n giá»‘ng nhau</em> giá»¯a cÃ¡c <em>users</em> cÃ³ thá»ƒ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh thÃ´ng qua <em>má»©c Ä‘á»™ quan tÃ¢m</em> cá»§a cÃ¡c <em>users</em> nÃ y tá»›i cÃ¡c <em>items</em> khÃ¡c mÃ  há»‡ thá»‘ng Ä‘Ã£ biáº¿t.  VÃ­ dá»¥, <em>A, B</em> Ä‘á»u thÃ­ch phim <em>Cáº£nh sÃ¡t hÃ¬nh sá»±</em>, tá»©c Ä‘á»u <em>rate</em> bá»™ phim nÃ y 5 sao. Ta Ä‘Ã£ biáº¿t <em>A</em> cÅ©ng thÃ­ch <em>NgÆ°á»i phÃ¡n xá»­</em>, váº­y nhiá»u kháº£ nÄƒng <em>B</em> cÅ©ng thÃ­ch bá»™ phim nÃ y.</p>

<p>CÃ¡c báº¡n cÃ³ thá»ƒ Ä‘Ã£ hÃ¬nh dung ra, hai cÃ¢u há»i quan trá»ng nháº¥t trong má»™t há»‡ thá»‘ng Neighborhood-based Collaborative Filtering lÃ :</p>

<ul>
  <li>LÃ m tháº¿ nÃ o xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c <em>sá»± giá»‘ng nhau</em> giá»¯a hai <em>users</em>?</li>
  <li>Khi Ä‘Ã£ xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c cÃ¡c <em>users</em> <em>gáº§n giá»‘ng nhau</em> (<em>similar users</em>) rá»“i, lÃ m tháº¿ nÃ o dá»± Ä‘oÃ¡n Ä‘Æ°á»£c <em>má»©c Ä‘á»™ quan tÃ¢m</em> cá»§a má»™t <em>user</em> lÃªn má»™t <em>item</em>?</li>
</ul>

<p>Viá»‡c xÃ¡c Ä‘á»‹nh má»©c Ä‘á»™ quan tÃ¢m cá»§a má»—i <em>user</em> tá»›i má»™t <em>item</em> dá»±a trÃªn má»©c Ä‘á»™ quan tÃ¢m cá»§a <em>similar users</em> tá»›i <em>item</em> Ä‘Ã³ cÃ²n Ä‘Æ°á»£c gá»i lÃ  <em>User-user collaborative filtering</em>. CÃ³ má»™t hÆ°á»›ng tiáº¿p cáº­n khÃ¡c Ä‘Æ°á»£c cho lÃ  lÃ m viá»‡c hiá»‡u quáº£ hÆ¡n lÃ  <em>Item-item collaborative filtering</em>. Trong hÆ°á»›ng tiáº¿p cáº­n nÃ y, thay vÃ¬ xÃ¡c Ä‘á»‹nh <em>user similarities</em>, há»‡ thá»‘ng sáº½ xÃ¡c Ä‘á»‹nh <em>item similarities</em>. Tá»« Ä‘Ã³, há»‡ thá»‘ng gá»£i Ã½ nhá»¯ng <em>items</em> <em>gáº§n giá»‘ng vá»›i</em> nhá»¯ng <em>items</em> mÃ  user cÃ³ má»©c Ä‘á»™ quan tÃ¢m cao.</p>

<p>Cáº¥u trÃºc cá»§a bÃ i viáº¿t nhÆ° sau: Má»¥c 2 sáº½ trÃ¬nh bÃ y <em>User-user Collaborative Filtering</em>. Má»¥c 3 sáº½ nÃªu má»™t sá»‘ háº¡n cháº¿ cá»§a  <em>User-user Collaborative Filtering</em> vÃ  cÃ¡ch kháº¯c phá»¥c báº±ng <em>Item-item Collaborative Filtering</em>. Káº¿t quáº£ cá»§a hai phÆ°Æ¡ng phÃ¡p nÃ y sáº½ Ä‘Æ°á»£c trÃ¬nh bÃ y qua vÃ­ dá»¥ trÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u <a href="/2017/05/17/contentbasedrecommendersys/#-co-so-du-lieu-movielens-k">MovieLens 100k</a> trong Má»¥c 4. Má»™t vÃ i tháº£o luáº­n vÃ  TÃ i liá»‡u tham kháº£o Ä‘Æ°á»£c cho trong Má»¥c 5 vÃ  6.</p>

<p><a name="-user-user-collaborative-filtering"></a></p>

<h2 id="2-user-user-collaborative-filtering">2. User-user Collaborative Filtering</h2>

<p><a name="-similarity-functions"></a></p>

<h3 id="21-similarity-functions">2.1. Similarity functions</h3>

<p>CÃ´ng viá»‡c quan trá»ng nháº¥t pháº£i lÃ m trÆ°á»›c tiÃªn trong User-user Collaborative Filtering lÃ  pháº£i xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c <em>sá»± giá»‘ng nhau</em> (<em>similarity</em>) giá»¯a hai <em>users</em>. Dá»¯ liá»‡u duy nháº¥t chÃºng ta cÃ³ lÃ  <em>Utility matrix</em> \(\mathbf{Y}\), váº­y nÃªn <em>sá»± giá»‘ng nhau</em> nÃ y pháº£i Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh dá»±a trÃªn cÃ¡c cá»™t tÆ°Æ¡ng á»©ng vá»›i hai <em>users</em> trong ma tráº­n nÃ y. XÃ©t vÃ­ dá»¥ trong HÃ¬nh 1.</p>

<hr />

<div>
<table width="100%" style="border: 0px solid white">
    <tr>
        <td width="40%" style="border: 0px solid white" align="center">
        <img style="display:block;" width="100%" src="\assets\24_collaborativefiltering\utility.png" />
         </td>
        <td width="40%" style="border: 0px solid white" align="justify">
        HÃ¬nh 1: VÃ­ dá»¥ vá» utility matrix dá»±a trÃªn sá»‘ sao má»™t <em>user rate</em> cho má»™t <em>item</em>. Má»™t cÃ¡ch trá»±c quan, <em>hÃ nh vi</em> cá»§a \(u_0\) giá»‘ng vá»›i \(u_1\) hÆ¡n lÃ  \(u_2, u_3, u_4, u_5, u_6\). Tá»« Ä‘Ã³ cÃ³ thá»ƒ dá»± Ä‘oÃ¡n ráº±ng \(u_0\) sáº½ quan tÃ¢m tá»›i \(i_2\) vÃ¬ \(u_1\) cÅ©ng quan tÃ¢m tá»›i <em>item</em> nÃ y.
        </td>
    </tr>
</table>
</div>
<hr />

<p>Giáº£ sá»­ cÃ³ cÃ¡c <em>users</em> tá»« \(u_0\) Ä‘áº¿n \(u_6\) vÃ  cÃ¡c <em>items</em> tá»« \(i_0\) Ä‘áº¿n \(i_4\) trong Ä‘Ã³ cÃ¡c sá»‘ trong má»—i Ã´ vuÃ´ng thá»ƒ hiá»‡n <em>sá»‘ sao</em> mÃ  má»—i <em>user</em> Ä‘Ã£ <em>rated</em> cho <em>item</em> vá»›i giÃ¡ trá»‹ cao hÆ¡n thá»ƒ hiá»‡n <em>má»©c Ä‘á»™ quan tÃ¢m</em> cao hÆ¡n. CÃ¡c dáº¥u há»i cháº¥m lÃ  cÃ¡c giÃ¡ trá»‹ mÃ  há»‡ thá»‘ng cáº§n pháº£i Ä‘i tÃ¬m. Äáº·t <em>má»©c Ä‘á»™ giá»‘ng nhau</em> cá»§a hai <em>users</em> \(u_i, u_j\) lÃ  \(\text{sim}(u_i, u_j)\).</p>

<p>Quan sÃ¡t Ä‘áº§u tiÃªn chÃºng ta cÃ³ thá»ƒ nháº­n tháº¥y lÃ  cÃ¡c \(u_0, u_1\) <em>thÃ­ch</em> \(i_0, i_1, i_2\) vÃ  <em>khÃ´ng thÃ­ch</em> \(i_3, i_4\) cho láº¯m. Äiá»u ngÆ°á»£c láº¡i xáº£y ra á»Ÿ cÃ¡c <em>users</em> cÃ²n láº¡i. VÃ¬ váº­y, má»™t <em>similiarity function</em> tá»‘t cáº§n Ä‘áº£m báº£o:</p>

<p>\[\text{sim}(u_0, u_1) &gt; \text{sim}(u_0, u_i), ~\forall i &gt; 1.\]</p>

<p>Tá»« Ä‘Ã³, Ä‘á»ƒ xÃ¡c Ä‘á»‹nh <em>má»©c Ä‘á»™ quan tÃ¢m</em> cá»§a \(u_0\) lÃªn \(i_2\), chÃºng ta nÃªn dá»±a trÃªn <em>hÃ nh vi</em> cá»§a \(u_1\) lÃªn sáº£n pháº©m nÃ y. Ráº¥t may ráº±ng \(u_1\) Ä‘Ã£ <em>thÃ­ch</em> \(i_2\) nÃªn há»‡ thá»‘ng cáº§n <em>recommend</em> \(i_2\) cho \(u_0\).</p>

<p>CÃ¢u há»i Ä‘áº·t ra lÃ : hÃ m sá»‘ <em>similarity</em> nÃ o lÃ  tá»‘t? Äá»ƒ Ä‘o <em>similarity</em> giá»¯a hai <em>users</em>, cÃ¡ch thÆ°á»ng lÃ m lÃ  xÃ¢y dá»±ng <em>feature vector</em> cho má»—i <em>user</em> rá»“i Ã¡p dá»¥ng má»™t hÃ m cÃ³ kháº£ nÄƒng Ä‘o <em>similarity</em> giá»¯a hai vectors Ä‘Ã³. ChÃº Ã½ ráº±ng viá»‡c xÃ¢y dá»±ng feature vector nÃ y khÃ¡c vá»›i viá»‡c xÃ¢y dá»±ng <a href="2017/05/17/contentbasedrecommendersys/#-item-profiles">item profiles</a> nhÆ° trong Content-based Recommendation Systems. CÃ¡c vectors nÃ y Ä‘Æ°á»£c xÃ¢y dá»±ng trá»±c tiáº¿p dá»±a trÃªn Utility matrix chá»© khÃ´ng dÃ¹ng dá»¯ liá»‡u ngoÃ i nhÆ° item profiles. Vá»›i má»—i user, thÃ´ng tin duy nháº¥t chÃºng ta biáº¿t lÃ  cÃ¡c <em>ratings</em> mÃ  <em>user</em> Ä‘Ã³ Ä‘Ã£ thá»±c hiá»‡n, tá»©c cá»™t tÆ°Æ¡ng á»©ng vá»›i <em>user</em> Ä‘Ã³ trong Utility matrix. Tuy nhiÃªn, khÃ³ khÄƒn lÃ  cÃ¡c cá»™t nÃ y thÆ°á»ng cÃ³ ráº¥t nhiá»u <em>mising ratings</em> vÃ¬ má»—i <em>user</em> thÆ°á»ng chá»‰ <em>rated</em> má»™t sá»‘ lÆ°á»£ng ráº¥t nhá» cÃ¡c <em>items</em>. CÃ¡ch kháº¯c phá»¥c lÃ  báº±ng cÃ¡ch nÃ o Ä‘Ã³, ta <em>giÃºp</em> há»‡ thá»‘ng <em>Ä‘iá»n</em> cÃ¡c giÃ¡ trá»‹ nÃ y sao cho viá»‡c Ä‘iá»n khÃ´ng lÃ m áº£nh hÆ°á»Ÿng nhiá»u tá»›i <em>sá»± giá»‘ng nhau</em> giá»¯a hai vector. Viá»‡c <em>Ä‘iá»n</em> nÃ y chá»‰ phá»¥c vá»¥ cho viá»‡c tÃ­nh <em>similarity</em> chá»© khÃ´ng pháº£i lÃ  <em>suy luáº­n</em> ra giÃ¡ trá»‹ cuá»‘i cÃ¹ng.</p>

<p>Váº­y má»—i dáº¥u â€˜?â€™ nÃªn Ä‘Æ°á»£c thay bá»Ÿi giÃ¡ trá»‹ nÃ o Ä‘á»ƒ háº¡n cháº¿ viá»‡c sai lá»‡ch quÃ¡ nhiá»u? Má»™t lá»±a chá»n báº¡n cÃ³ thá»ƒ nghÄ© tá»›i lÃ  thay cÃ¡c dáº¥u â€˜?â€™ báº±ng giÃ¡ trá»‹ â€˜0â€™. Äiá»u nÃ y khÃ´ng thá»±c sá»± tá»‘t vÃ¬ giÃ¡ trá»‹ â€˜0â€™ tÆ°Æ¡ng á»©ng vá»›i má»©c Ä‘á»™ quan tÃ¢m tháº¥p nháº¥t. Má»™t giÃ¡ trá»‹ <em>an toÃ n</em> hÆ¡n lÃ  2.5 vÃ¬ nÃ³ lÃ  trung bÃ¬nh cá»™ng cá»§a 0, má»©c tháº¥p nháº¥t, vÃ  5, má»©c cao nháº¥t. Tuy nhiÃªn, giÃ¡ trá»‹ nÃ y cÃ³ háº¡n cháº¿ Ä‘á»‘i vá»›i nhá»¯ng <em>users</em> <em>dá»… tÃ­nh</em> hoáº·c <em>khÃ³ tÃ­nh</em>. Vá»›i cÃ¡c <em>users</em> dá»… tÃ­nh, <em>thÃ­ch</em> tÆ°Æ¡ng á»©ng vá»›i 5 sao, <em>khÃ´ng thÃ­ch</em> cÃ³ thá»ƒ Ã­t sao hÆ¡n 1 chÃºt, 3 sao cháº³ng háº¡n. Viá»‡c chá»n giÃ¡ trá»‹ 2.5 sáº½ khiáº¿n cho cÃ¡c <em>items</em> cÃ²n láº¡i lÃ  quÃ¡ <em>negative</em> Ä‘á»‘i vá»›i <em>user</em> Ä‘Ã³. Äiá»u ngÆ°á»£c láº¡i xáº£y ra vá»›i nhá»¯ng <em>user</em> khÃ³ tÃ­nh hÆ¡n khi chá»‰ cho 3 sao cho cÃ¡c <em>items</em> há» thÃ­ch vÃ  Ã­t sao hÆ¡n cho nhá»¯ng <em>items</em> há» khÃ´ng thÃ­ch.</p>

<p>Má»™t giÃ¡ trá»‹ kháº£ dÄ© hÆ¡n cho viá»‡c nÃ y lÃ  trung bÃ¬nh cá»™ng cá»§a cÃ¡c <em>ratings</em> mÃ  <em>user</em> tÆ°Æ¡ng á»©ng Ä‘Ã£ thá»±c hiá»‡n. Viá»‡c nÃ y sáº½ trÃ¡nh Ä‘Æ°á»£c viá»‡c <em>users</em> quÃ¡ khÃ³ tÃ­nh hoáº·c dá»… tÃ­nh, tá»©c lÃºc nÃ o cÅ©ng cÃ³ nhá»¯ng <em>items</em> mÃ  má»™t <em>user</em> thÃ­ch hÆ¡n so vá»›i nhá»¯ng <em>items</em> khÃ¡c.</p>

<p>HÃ£y cÃ¹ng xem vÃ­ dá»¥ trong HÃ¬nh 2a) vÃ  2b).</p>

<hr />

<div class="imgcap">
<img src="\assets\24_collaborativefiltering\user_cf.png" align="center" width="800" />
<div class="thecap" align="left">HÃ¬nh 2: VÃ­ dá»¥ mÃ´ táº£ User-user Collaborative Filtering. a) Utility Matrix ban Ä‘áº§u. b) Utility Matrix Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hoÃ¡. c) User similarity matrix. d) Dá»± Ä‘oÃ¡n cÃ¡c (normalized) <em>ratings</em> cÃ²n thiáº¿u. e) VÃ­ dá»¥ vá» cÃ¡ch dá»± Ä‘oÃ¡n normalized rating cá»§a \(u_1\) cho \(i_1\). f) Dá»± Ä‘oÃ¡n cÃ¡c (denormalized) <em>ratings</em> cÃ²n thiáº¿u. </div>
</div>
<hr />

<p><strong>Chuáº©n hoÃ¡ dá»¯ liá»‡u:</strong></p>

<p>HÃ ng cuá»‘i cÃ¹ng trong HÃ¬nh 2a) lÃ  giÃ¡ trá»‹ trung bÃ¬nh cá»§a <em>ratings</em> cho má»—i <em>user</em>. GiÃ¡ trá»‹ cao tÆ°Æ¡ng á»©ng vá»›i cÃ¡c <em>user dá»… tÃ­nh</em> vÃ  ngÆ°á»£c láº¡i. Khi Ä‘Ã³, náº¿u tiáº¿p tá»¥c trá»« tá»« má»—i <em>rating</em> Ä‘i giÃ¡ trá»‹ nÃ y vÃ  thay cÃ¡c giÃ¡ trá»‹ chÆ°a biáº¿t báº±ng 0, ta sáº½ Ä‘Æ°á»£c <em>normalized utility matrix</em> nhÆ° trong HÃ¬nh 2b). Báº¡n cÃ³ thá»ƒ tháº¯c máº¯c táº¡i sao bÆ°á»›c chuáº©n hoÃ¡ nÃ y láº¡i quan trá»ng, cÃ¢u tráº£ lá»i á»Ÿ ngay Ä‘Ã¢y:</p>

<ul>
  <li>Viá»‡c trá»« Ä‘i trung bÃ¬nh cá»™ng cá»§a má»—i <em>cá»™t</em> khiáº¿n trong trong má»—i cá»™t cÃ³ nhá»¯ng giÃ¡ trá»‹ dÆ°Æ¡ng vÃ  Ã¢m. Nhá»¯ng giÃ¡ trá»‹ dÆ°Æ¡ng tÆ°Æ¡ng á»©ng vá»›i viá»‡c <em>user thÃ­ch item</em>, nhá»¯ng giÃ¡ trá»‹ Ã¢m tÆ°Æ¡ng á»©ng vá»›i viá»‡c <em>user khÃ´ng thÃ­ch item</em>. Nhá»¯ng giÃ¡ trá»‹ báº±ng 0 tÆ°Æ¡ng á»©ng vá»›i viá»‡c <em>chÆ°a xÃ¡c Ä‘á»‹nh</em> Ä‘Æ°á»£c liá»‡u <em>user</em> cÃ³ thÃ­ch <em>item</em> hay khÃ´ng.</li>
  <li>Vá» máº·t ká»¹ thuáº­t, sá»‘ chiá»u cá»§a utility matrix lÃ  ráº¥t lá»›n vá»›i hÃ ng triá»‡u <em>users</em> vÃ  <em>items</em>, náº¿u lÆ°u toÃ n bá»™ cÃ¡c giÃ¡ trá»‹ nÃ y trong má»™t ma tráº­n thÃ¬ kháº£ nÄƒng cao lÃ  sáº½ khÃ´ng Ä‘á»§ bá»™ nhá»›. Quan sÃ¡t tháº¥y ráº±ng vÃ¬ sá»‘ lÆ°á»£ng <em>ratings</em> biáº¿t trÆ°á»›c thÆ°á»ng lÃ  má»™t sá»‘ ráº¥t nhá» so vá»›i kÃ­ch thÆ°á»›c cá»§a utility matrix, sáº½ tá»‘t hÆ¡n náº¿u chÃºng ta lÆ°u ma tráº­n nÃ y dÆ°á»›i dáº¡ng <em>sparse matrix</em>, tá»©c chá»‰ lÆ°u cÃ¡c giÃ¡ trá»‹ khÃ¡c khÃ´ng vÃ  vá»‹ trÃ­ cá»§a chÃºng. VÃ¬ váº­y, tá»‘t hÆ¡n háº¿t, cÃ¡c dáº¥u â€˜?â€™ nÃªn Ä‘Æ°á»£c thay báº±ng giÃ¡ trá»‹ â€˜0â€™, tá»©c chÆ°a xÃ¡c Ä‘á»‹nh liá»‡u <em>user</em> cÃ³ thÃ­ch <em>item</em> hay khÃ´ng. Viá»‡c nÃ y khÃ´ng nhá»¯ng tá»‘i Æ°u bá»™ nhá»› mÃ  viá»‡c tÃ­nh toÃ¡n <em>similarity matrix</em> sau nÃ y cÅ©ng hiá»‡u quáº£ hÆ¡n.</li>
</ul>

<p>Sau khi Ä‘Ã£ chuáº©n hoÃ¡ dá»¯ liá»‡u nhÆ° trÃªn, má»™t vÃ i <em>similiraty function</em> thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng lÃ :</p>

<p><strong>Cosine Similarity:</strong></p>

<p>ÄÃ¢y lÃ  hÃ m Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u nháº¥t, vÃ  cÅ©ng quen thuá»™c vá»›i cÃ¡c báº¡n nháº¥t. Náº¿u cÃ¡c báº¡n khÃ´ng nhá»› cÃ´ng thá»©c tÃ­nh \(\text{cos}\) cá»§a gÃ³c giá»¯a hai vector \(\mathbf{u}_1, \mathbf{u}_2\) trong chÆ°Æ¡ng trÃ¬nh phá»• thÃ´ng, thÃ¬ dÆ°á»›i Ä‘Ã¢y lÃ  cÃ´ng thá»©c:</p>

<p>\[
\text{cosine_similarity}(\mathbf{u}_1, \mathbf{u}_2) =\text{cos}(\mathbf{u}_1, \mathbf{u}_2) 
=  \frac{\mathbf{u}_1^T\mathbf{u}_2}{ ||\mathbf{u}_1||_2.||\mathbf{u}_2||_2}~~~~ (1)
\]</p>

<p>Trong Ä‘Ã³ \(\mathbf{u}_{1, 2}\) lÃ  vectors tÆ°Æ¡ng á»©ng vá»›i <em>users 1, 2</em>  <strong>Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hoÃ¡</strong> nhÆ° á»Ÿ trÃªn.</p>

<p>CÃ³ má»™t tin vui lÃ  python cÃ³ hÃ m há»— trá»£ tÃ­nh toÃ¡n hÃ m sá»‘ nÃ y má»™t cÃ¡ch hiá»‡u quáº£.</p>

<p>Äá»™ <em>similarity</em> cá»§a hai vector lÃ  1 sá»‘ trong Ä‘oáº¡n [-1, 1]. GiÃ¡ trá»‹ báº±ng 1 thá»ƒ hiá»‡n hai vector hoÃ n toÃ n <em>similar</em> nhau. HÃ m sá»‘ \(\text{cos}\) cá»§a má»™t gÃ³c báº±ng 1 nghÄ©a lÃ  gÃ³c giá»¯a hai vector báº±ng 0, tá»©c má»™t vector báº±ng tÃ­ch cá»§a má»™t sá»‘ dÆ°Æ¡ng vá»›i vector cÃ²n láº¡i. GiÃ¡ trá»‹ \(\text{cos}\) báº±ng -1 thá»ƒ hiá»‡n hai vector nÃ y hoÃ n toÃ n trÃ¡i ngÆ°á»£c nhau. Äiá»u nÃ y cÅ©ng há»£p lÃ½ , tá»©c khi <em>hÃ nh vi</em> cá»§a hai <em>users</em> lÃ  hoÃ n toÃ n ngÆ°á»£c nhau thi <em>similarity</em> giá»¯a hai vector Ä‘Ã³ lÃ  tháº¥p nháº¥t.</p>

<p>VÃ­ dá»¥ vá» cosine_similarity cá»§a cÃ¡c <em>users</em> trong HÃ¬nh 2b) Ä‘Æ°á»£c cho trong HÃ¬nh 2c). Similarity matrix \(\mathbf{S}\) lÃ  má»™t ma tráº­n Ä‘á»‘i xá»©ng vÃ¬ \(\text{cos}\) lÃ  má»™t hÃ m cháºµn, vÃ  náº¿u <em>user A giá»‘ng user B</em> thÃ¬ Ä‘iá»u ngÆ°á»£c láº¡i cÅ©ng Ä‘Ãºng. CÃ¡c Ã´ mÃ u xanh trÃªn Ä‘Æ°á»ng chÃ©o Ä‘á»u báº±ng 1 vÃ¬ Ä‘Ã³ lÃ  \(\text{cos}\) cá»§a gÃ³c giá»¯a 1 vector vÃ  chÃ­nh nÃ³, tá»©c \(\text{cos}(0) = 1\). Khi tÃ­nh toÃ¡n á»Ÿ cÃ¡c bÆ°á»›c sau, chÃºng ta khÃ´ng cáº§n quan tÃ¢m tá»›i cÃ¡c giÃ¡ trá»‹ 1 nÃ y. Tiáº¿p tá»¥c quan sÃ¡t cÃ¡c vector hÃ ng tÆ°Æ¡ng á»©ng vá»›i \(u_0, u_1, u_2\), chÃºng ta sáº½ tháº¥y má»™t vÃ i Ä‘iá»u thÃº vá»‹:</p>

<ul>
  <li>
    <p>\(u_0\) <em>gáº§n</em> vá»›i \(u_1\) vÃ  \(u_5\) (Ä‘á»™ giá»‘ng nhau lÃ  dÆ°Æ¡ng) hÆ¡n cÃ¡c <em>users</em> cÃ²n láº¡i. Viá»‡c <em>similarity</em> cao giá»¯a \(u_0\) vÃ  \(u_1\) lÃ  dá»… hiá»ƒu vÃ¬ cáº£ hai Ä‘á»u cÃ³ xu hÆ°á»›ng quan tÃ¢m tá»›i \(i_0, i_1, i_2\) hÆ¡n cÃ¡c <em>items</em> cÃ²n láº¡i. Viá»‡c \(u_0\) <em>gáº§n</em> vá»›i \(u_5\) thoáº¡t Ä‘áº§u cÃ³ váº» vÃ´ lÃ½ vÃ¬ \(u_5\) Ä‘Ã¡nh giÃ¡ tháº¥p cÃ¡c <em>items</em> mÃ  \(u_0\) Ä‘Ã¡nh giÃ¡ cao (HÃ¬nh 2a)); tuy nhiÃªn khi nhÃ¬n vÃ o ma tráº­n utility Ä‘Ã£ chuáº©n hoÃ¡ á»Ÿ HÃ¬nh 2b), ta tháº¥y ráº±ng Ä‘iá»u nÃ y lÃ  há»£p lÃ½. VÃ¬ <em>item</em> duy nháº¥t mÃ  cáº£ hai <em>users</em> nÃ y Ä‘Ã£ cung cáº¥p thÃ´ng tin lÃ  \(i_1\) vá»›i cÃ¡c giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng Ä‘á»u lÃ  <em>tÃ­ch cá»±c</em>.</p>
  </li>
  <li>
    <p>\(u_1\) gáº§n vá»›i \(u_0\) vÃ  xa cÃ¡c <em>users</em> cÃ²n láº¡i.</p>
  </li>
  <li>
    <p>\(u_2\) gáº§n vá»›i \(u_3, u_4, u_5, u_6\) vÃ  xa cÃ¡c <em>users</em> cÃ²n láº¡i.</p>
  </li>
</ul>

<p>Tá»« <em>similarity matrix</em> nÃ y, chÃºng ta cÃ³ thá»ƒ phÃ¢n nhÃ³m cÃ¡c <em>users</em> ra lÃ m hai nhÃ³m \((u_0, u_1)\) vÃ  \((u_2, u_3, u_4, u_5, u_6)\). VÃ¬ ma tráº­n \(\mathbf{S}\) nÃ y nhá» nÃªn chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng quan sÃ¡t tháº¥y Ä‘iá»u nÃ y; khi sá»‘ <em>users</em> lá»›n hÆ¡n, viá»‡c xÃ¡c Ä‘á»‹nh báº±ng <em>máº¯t thÆ°á»ng</em> lÃ  khÃ´ng kháº£ thi. Viá»‡c xÃ¢y dá»±ng thuáº­t toÃ¡n phÃ¢n nhÃ³m cÃ¡c <em>users</em> (<em>users clustering</em>) <em>ráº¥t cÃ³ thá»ƒ</em> sáº½ Ä‘Æ°á»£c trÃ¬nh bÃ y á»Ÿ má»™t trong cÃ¡c bÃ i viáº¿t tiáº¿p theo.</p>

<p>CÃ³ má»™t chÃº Ã½ quan trá»ng á»Ÿ Ä‘Ã¢y lÃ  khi sá»‘ lÆ°á»£ng <em>users</em> lá»›n, ma tráº­n \(\mathbf{S}\) cÅ©ng ráº¥t lá»›n vÃ  nhiá»u kháº£ nÄƒng lÃ  khÃ´ng cÃ³ Ä‘á»§ bá»™ nhá»› Ä‘á»ƒ lÆ°u trá»¯, ngay cáº£ khi chá»‰ lÆ°u hÆ¡n má»™t ná»­a sá»‘ cÃ¡c pháº§n tá»­ cá»§a ma tráº­n <em>Ä‘á»‘i xá»©ng</em> nÃ y. Vá»›i cÃ¡c trÆ°á»ng há»£p Ä‘Ã³, má»›i má»—i <em>user</em>, chÃºng ta chá»‰ cáº§n tÃ­nh vÃ  lÆ°u káº¿t quáº£ cá»§a má»™t hÃ ng cá»§a <em>similarity matrix</em>, tÆ°Æ¡ng á»©ng vá»›i viá»‡c Ä‘á»™ <em>giá»‘ng nhau</em> giá»¯a <em>user</em> Ä‘Ã³ vÃ  cÃ¡c <em>users</em> cÃ²n láº¡i.</p>

<p>Trong bÃ i viáº¿t nÃ y, tÃ´i sáº½ sá»­ dá»¥ng <em>similarity function</em> nÃ y.</p>

<p><strong>Person corelation:</strong></p>

<p>TÃ´i xin khÃ´ng Ä‘i chi tiáº¿t vá» pháº§n nÃ y, báº¡n Ä‘á»c quan tÃ¢m cÃ³ thá»ƒ Ä‘á»c thÃªm <a href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient">Pearson correlation coefficient - Wikipedia</a></p>

<p><a name="-rating-prediction"></a></p>

<h3 id="22-rating-prediction">2.2. Rating prediction</h3>

<p>Viá»‡c xÃ¡c Ä‘á»‹nh má»©c Ä‘á»™ quan tÃ¢m cá»§a má»™t <em>user</em> lÃªn má»™t <em>item</em> dá»±a trÃªn cÃ¡c <em>users gáº§n nháº¥t</em> (<em>neighbor users</em>) nÃ y ráº¥t giá»‘ng vá»›i nhá»¯ng gÃ¬ chÃºng ta tháº¥y trong <a href="/2017/01/08/knn/">BÃ i 6: K-nearest neighbors</a>. Khi lÃ m viá»‡c vá»›i <em>large-scale problems</em>, chÃºng ta sáº½ tháº¥y thÃªm ráº±ng phÆ°Æ¡ng phÃ¡p <em>lÆ°á»i há»c</em> K-nearest neighbors (KNN) Ä‘Æ°á»£c sá»­ dá»¥ng ráº¥t nhiá»u vÃ¬ tÃ­nh Ä‘Æ¡n giáº£n cá»§a nÃ³. Táº¥t nhiÃªn, chÃºng ta khÃ´ng thá»ƒ trá»±c tiáº¿p sá»­ dá»¥ng KNN mÃ  cÃ²n cáº§n pháº£i lÃ m thÃªm nhiá»u bÆ°á»›c trung gian ná»¯a.</p>

<p>TÆ°Æ¡ng tá»± nhÆ° KNN, trong Collaborative Filtering, <em>missing rating</em> cÅ©ng Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh dá»±a trÃªn thÃ´ng tin vá» \(k\) <em>neighbor users</em>. Táº¥t nhiÃªn, chÃºng ta chá»‰ quan tÃ¢m tá»›i <strong>cÃ¡c <em>users</em> Ä‘Ã£ <em>rated item</em> Ä‘ang xÃ©t</strong>. <em>Predicted rating</em> thÆ°á»ng Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh lÃ  <em>trung bÃ¬nh cÃ³ trá»ng sá»‘</em> cá»§a cÃ¡c <em>ratings</em> <strong>Ä‘Ã£ chuáº©n hoÃ¡</strong>. CÃ³ má»™t Ä‘iá»ƒm cáº§n lÆ°u Ã½, trong KNN, cÃ¡c trá»ng sá»‘ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh dá»±a trÃªn <em>distance</em> giá»¯a 2 Ä‘iá»ƒm, vÃ  cÃ¡c <em>distance</em> nÃ y lÃ  cÃ¡c sá»‘ khÃ´ng Ã¢m. Trong khi Ä‘Ã³, trong CF, cÃ¡c trá»ng sá»‘ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh dá»±a trÃªn <em>similarity</em> giá»¯a hai <em>users</em>, nhá»¯ng trá»ng sá»‘ nÃ y cÃ³ thá»ƒ nhá» hÆ¡n 0 nhÆ° trong HÃ¬nh 2c).</p>

<p>CÃ´ng thá»©c phá»• biáº¿n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ dá»± Ä‘oÃ¡n <em>rating</em> cá»§a \(u\) cho \(i\) lÃ :</p>

<p>\[
\hat{y}_{i, u} = \frac{\sum_{u_j \in \mathcal{N}(u, i)} \bar{y}_{i, u_j} \text{sim}(u, u_j)}{\sum_{u_j \in \mathcal{N}(u, i)} |\text{sim}(u, u_j)|} ~~~~ (2)
\]
(sá»± khÃ¡c biáº¿t so vá»›i trung bÃ¬nh cÃ³ trá»ng sá»‘ lÃ  máº«u sá»‘ cÃ³ sá»­ dá»¥ng trá»‹ tuyá»‡t Ä‘á»‘i Ä‘á»ƒ xá»­ lÃ½ cÃ¡c sá»‘ Ã¢m).</p>

<p>trong Ä‘Ã³ \(\mathcal{N}(u, i)\) lÃ  táº­p há»£p \(k\) <em>users</em> trong <em>neighborhood</em>  (tá»©c cÃ³ <em>similarity</em> cao nháº¥t) cá»§a \(u\) mÃ  <strong>Ä‘Ã£ rated</strong> \(i\).</p>

<p>HÃ¬nh 2d) thá»ƒ hiá»‡n viá»‡c <em>Ä‘iá»n</em> cÃ¡c giÃ¡ trá»‹ cÃ²n thiáº¿u trong <em>normalized utility matrix</em>. CÃ¡c Ã´ mÃ u ná»n Ä‘á» thá»ƒ hiá»‡n cÃ¡c giÃ¡ trá»‹ dÆ°Æ¡ng, tá»©c cÃ¡c <em>items</em> mÃ  <em>cÃ³ thá»ƒ users</em> Ä‘Ã³ <em>quan tÃ¢m</em>. á» Ä‘Ã¢y, tÃ´i Ä‘Ã£ láº¥y ngÆ°á»¡ng báº±ng 0, chÃºng ta hoÃ n toÃ n cÃ³ thá»ƒ chá»n cÃ¡c <em>ngÆ°á»¡ng</em> khÃ¡c 0.</p>

<p>Má»™t vÃ­ dá»¥ vá» viá»‡c tÃ­nh <em>normalized rating</em> cá»§a \(u_1\) cho \(i_1\) Ä‘Æ°á»£c cho trong HÃ¬nh 2e) vá»›i sá»‘ <em>nearest neighbors</em> lÃ  \(k = 2\). CÃ¡c bÆ°á»›c thá»±c hiá»‡n lÃ :</p>

<ol>
  <li>
    <p>XÃ¡c Ä‘á»‹nh cÃ¡c <em>users</em> Ä‘Ã£ <em>rated</em> \(i_1\), Ä‘Ã³ lÃ  \(u_0, u_3, u_5\).</p>
  </li>
  <li>
    <p>XÃ¡c Ä‘á»‹nh <em>similarities</em> cá»§a \(u_1\) vá»›i cÃ¡c <em>users</em> nÃ y ta nháº­n Ä‘Æ°á»£c \({0.83, -0.40, -0.23}\). Hai (\(k = 2\)) giÃ¡ trá»‹ lá»›n nháº¥t lÃ  \(0.83\) vÃ  \(-0.23\) tÆ°Æ¡ng á»©ng vá»›i \(u_0\) vÃ  \(u_5\).</p>
  </li>
  <li>
    <p>XÃ¡c Ä‘á»‹nh cÃ¡c <em>normalized ratings</em> cá»§a \(u_0, u_5\) cho \(i_1\), ta thu Ä‘Æ°á»£c hai giÃ¡ trá»‹ láº§n lÆ°á»£t lÃ  \(0.75\) vÃ  \(0.5\).</p>
  </li>
  <li>
    <p>Dá»± Ä‘oÃ¡n káº¿t quáº£:</p>
  </li>
</ol>

<p>\[
\hat{y}_{i_1, u_1} = \frac{0.83\times 0.75 + (-0.23)\times 0.5}{0.83 + |-0.23|} \approx 0.48
\]</p>

<p>Viá»‡c quy Ä‘á»•i cÃ¡c giÃ¡ trá»‹ ratings Ä‘Ã£ chuáº©n hoÃ¡ vá» thang 5 cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n báº±ng cÃ¡ch cá»™ng cÃ¡c cá»™t cá»§a ma tráº­n \(\hat{\mathbf{Y}}\) vá»›i giÃ¡ trá»‹ rating trung bÃ¬nh cá»§a má»—i <em>user</em> nhÆ° Ä‘Ã£ tÃ­nh trong HÃ¬nh 2a).</p>

<p>Viá»‡c há»‡ thá»‘ng quyáº¿t Ä‘á»‹nh <em>recommend items</em> nÃ o cho má»—i <em>user</em> cÃ³ thá»ƒ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh báº±ng nhiá»u cÃ¡ch khÃ¡c nhau. CÃ³ thá»ƒ sáº¯p xáº¿p <em>unrated items</em> theo thá»© tá»± tá»± lá»›n Ä‘áº¿n bÃ© cá»§a cÃ¡c <em>predicted ratings</em>, hoáº·c chá»‰ chá»n cÃ¡c <em>items</em> cÃ³ <em>normalized predicted ratings</em> dÆ°Æ¡ng - tÆ°Æ¡ng á»©ng vá»›i viá»‡c <em>user</em> nÃ y cÃ³ nhiá»u kháº£ nÄƒng thÃ­ch hÆ¡n.</p>

<p>TrÆ°á»›c khi vÃ o pháº§n láº­p trÃ¬nh cho User-user CF, chÃºng ta cÃ¹ng xem xÃ©t Item-item CF.</p>

<p><a name="-item-item-collaborative-filtering"></a></p>

<h2 id="3-item-item-collaborative-filtering">3. Item-item Collaborative Filtering</h2>
<p>Má»™t sá»‘ háº¡n chÃªs cá»§a User-user CF:</p>

<ul>
  <li>
    <p>TrÃªn thá»±c táº¿, sá»‘ lÆ°á»£ng <em>users</em> luÃ´n lá»›n hÆ¡n sá»‘ lÆ°á»£ng <em>items</em> ráº¥t nhiá»u. KÃ©o theo Ä‘Ã³ lÃ  <em>Similarity matrix</em> lÃ  ráº¥t lá»›n vá»›i sá»‘ pháº§n tá»­ pháº£i lÆ°u giá»¯ lÃ  hÆ¡n 1 ná»­a cá»§a bÃ¬nh phÆ°Æ¡ng sá»‘ lÆ°á»£ng <em>users</em> (chÃº Ã½ ráº±ng ma tráº­n nÃ y lÃ  Ä‘á»‘i xá»©ng). Viá»‡c nÃ y, nhÆ° Ä‘Ã£ Ä‘á» cáº­p á»Ÿ trÃªn, khiáº¿n cho viá»‡c lÆ°u trá»¯ ma tráº­n nÃ y trong nhiá»u trÆ°á»ng há»£p lÃ  khÃ´ng kháº£ thi.</p>
  </li>
  <li>
    <p>Ma tráº­n Utility \(\mathbf{Y}\) thÆ°á»ng lÃ  ráº¥t <em>sparse</em>. Vá»›i sá»‘ lÆ°á»£ng <em>users</em> ráº¥t lá»›n so vá»›i sá»‘ lÆ°á»£ng <em>items</em>, ráº¥t nhiá»u cá»™t cá»§a ma tráº­n nÃ y sáº½ ráº¥t <em>sparse</em>, tá»©c chá»‰ cÃ³ má»™t vÃ i pháº§n tá»­ khÃ¡c 0. LÃ½ do lÃ  <em>users</em> thÆ°á»ng <em>lÆ°á»i</em> rating. CÅ©ng chÃ­nh vÃ¬ viá»‡c nÃ y, má»™t khi <em>user</em> Ä‘Ã³ thay Ä‘á»•i <em>rating</em> hoáº·c rate thÃªm <em>items</em>, trung bÃ¬nh cá»™ng cÃ¡c <em>ratings</em> cÅ©ng nhÆ° vector chuáº©n hoÃ¡ tÆ°Æ¡ng á»©ng vá»›i <em>user</em> nÃ y thay Ä‘á»•i nhiá»u. KÃ©o theo Ä‘Ã³, viá»‡c tÃ­nh toÃ¡n ma tráº­n Similarity, vá»‘n tá»‘n nhiá»u bá»™ nhá»› vÃ  thá»i gian, cÅ©ng cáº§n Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i.</p>
  </li>
</ul>

<p>NgÆ°á»£c láº¡i, náº¿u chÃºng ta tÃ­nh toÃ¡n <em>similarity</em> giá»¯a cÃ¡c <em>items</em> rá»“i <em>recommend</em> nhá»¯ng <em>items</em> gáº§n <em>giá»‘ng</em> vá»›i <em>item</em> yÃªu thÃ­ch cá»§a má»™t <em>user</em> thÃ¬ sáº½ cÃ³ nhá»¯ng lá»£i Ã­ch sau:</p>

<ul>
  <li>
    <p>VÃ¬ sá»‘ lÆ°á»£ng <em>items</em> thÆ°á»ng nhá» hÆ¡n sá»‘ lÆ°á»£ng <em>users</em>, Similarity matrix trong trÆ°á»ng há»£p nÃ y cÅ©ng nhá» hÆ¡n nhiá»u, thuáº­n lá»£i cho viá»‡c lÆ°u trá»¯ vÃ  tÃ­nh toÃ¡n á»Ÿ cÃ¡c bÆ°á»›c sau.</p>
  </li>
  <li>
    <p>VÃ¬ sá»‘ lÆ°á»£ng pháº§n tá»­ Ä‘Ã£ biáº¿t trong Utility matrix lÃ  nhÆ° nhau nhÆ°ng sá»‘ hÃ ng (<em>items</em>) Ã­t hÆ¡n sá»‘ cá»™t (<em>users</em>), nÃªn trung bÃ¬nh, má»—i hÃ ng cá»§a ma tráº­n nÃ y sáº½ cÃ³ nhiá»u pháº§n tá»­ Ä‘Ã£ biáº¿t hÆ¡n sá»‘ pháº§n tá»­ Ä‘Ã£ biáº¿t trong má»—i cá»™t. Viá»‡c nÃ y cÅ©ng dá»… hiá»ƒu vÃ¬ má»—i <em>item</em> cÃ³ thá»ƒ Ä‘Æ°á»£c <em>rated</em> bá»Ÿi nhiá»u <em>users</em>. KÃ©o theo Ä‘Ã³, giÃ¡ trá»‹ trung bÃ¬nh cá»§a má»—i hÃ ng Ã­t bá»‹ thay Ä‘á»•i hÆ¡n khi cÃ³ thÃªm má»™t vÃ i <em>ratings</em>. NhÆ° váº­y, viá»‡c cáº­p nháº­t ma tráº­n Similarity Matrix cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n Ã­t thÆ°á»ng xuyÃªn hÆ¡n.</p>
  </li>
</ul>

<p>CÃ¡ch tiáº¿p cáº­n thá»© hai nÃ y Ä‘Æ°á»£c gá»i lÃ  <em>Item-item Collaborative Filtering</em>. HÆ°á»›ng tiáº¿p cáº­n nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u trong thá»±c táº¿ hÆ¡n.</p>

<p>Quy trÃ¬nh dá»± Ä‘oÃ¡n <em>missing ratings</em> cÅ©ng tÆ°Æ¡ng tá»± nhÆ° trong User-user CF. HÃ¬nh 3 mÃ´ táº£ quy trÃ¬nh nÃ y vá»›i vÃ­ dá»¥ nÃªu á»Ÿ pháº§n trÃªn.</p>

<div class="imgcap">
<img src="\assets\24_collaborativefiltering\item_cf.png" align="center" width="800" />
<div class="thecap" align="left">HÃ¬nh 3: VÃ­ dá»¥ mÃ´ táº£ Item-Item Collaborative Filtering. a) Utility Matrix ban Ä‘áº§u. b) Utility Matrix Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hoÃ¡. c) User similarity matrix. d) Dá»± Ä‘oÃ¡n cÃ¡c (normalized) <em>ratings</em> cÃ²n thiáº¿u.</div>
</div>

<p>CÃ³ má»™t Ä‘iá»ƒm thÃº vá»‹ trong Similarity matrix á»Ÿ HÃ¬nh 3c) lÃ  cÃ³ cÃ¡c pháº§n tá»­ trong hai hÃ¬nh vuÃ´ng xanh vÃ  Ä‘á» Ä‘á»u lÃ  cÃ¡c sá»‘ khÃ´ng Ã¢m, cÃ¡c pháº§n tá»­ bÃªn ngoÃ i lÃ  cÃ¡c sá»‘ Ã¢m. Viá»‡c nÃ y thá»ƒ hiá»‡n ráº±ng cÃ¡c <em>items</em> cÃ³ thá»ƒ Ä‘Æ°á»£c chia thÃ nh 2 nhÃ³m rÃµ rá»‡t vá»›i nhá»¯ng <em>items</em> cÃ³ <em>similarity</em> khÃ´ng Ã¢m vÃ o 1 nhÃ³m. NhÆ° váº­y, má»™t cÃ¡ch <em>vÃ´ tÃ¬nh</em>, chÃºng ta Ä‘Ã£ thá»±c hiá»‡n viá»‡c <em>item clustering</em>. Viá»‡c nÃ y sáº½ giÃºp Ã­ch ráº¥t nhiá»u trong viá»‡c dá»± Ä‘oÃ¡n á»Ÿ pháº§n sau.</p>

<p>Káº¿t quáº£ vá» viá»‡c chá»n <em>items</em> nÃ o Ä‘á»ƒ <em>recommend</em> cho má»—i <em>user</em> Ä‘Æ°á»£c thá»ƒ hiá»‡n bá»Ÿi cÃ¡c Ã´ mÃ u Ä‘á» trong HÃ¬nh 3d). Káº¿t quáº£ nÃ y cÃ³ khÃ¡c má»™t chÃºt so vá»›i káº¿t quáº£ tÃ¬m Ä‘Æ°á»£c bá»Ÿi User-user CF á»Ÿ 2 cá»™t cuá»‘i cÃ¹ng tÆ°Æ¡ng á»©ng vá»›i \(u_5, u_6\). DÆ°á»ng nhÆ° káº¿t quáº£ nÃ y <em>há»£p lÃ½</em> hÆ¡n vÃ¬ tá»« Utility Matrix, cÃ³ hai nhÃ³m <em>users</em> thÃ­ch hai nhÃ³m <em>items</em> khÃ¡c nhau. (Báº¡n cÃ³ nháº­n ra khÃ´ng?)</p>

<p><strong>Vá» máº·t tÃ­nh toÃ¡n, Item-item CF cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c tá»« User-user CF báº±ng cÃ¡ch chuyá»ƒn vá»‹ (transpose) ma tráº­n utility, vÃ  coi nhÆ° <em>items</em> Ä‘ang <em>rate</em> <em>users</em>. Sau khi tÃ­nh ra káº¿t quáº£ cuá»‘i cÃ¹ng, ta láº¡i chuyá»ƒn vá»‹ má»™t láº§n ná»¯a Ä‘á»ƒ thu Ä‘Æ°á»£c káº¿t quáº£.</strong></p>

<p>Pháº§n 3 dÆ°á»›i Ä‘Ã¢y sáº½ mÃ´ táº£ cÃ¡ch láº­p trÃ¬nh cho Collaborative Filtering trÃªn python. ChÃº Ã½ ráº±ng thÆ° viá»‡n <code class="language-plaintext highlighter-rouge">sklearn</code> tÃ´i váº«n dÃ¹ng khÃ´ng cÃ³ cÃ¡c modules cho Recommendation Systems.</p>

<p><a name="-lap-trinh-collaborative-filtering-tren-python"></a></p>

<h2 id="4-láº­p-trÃ¬nh-collaborative-filtering-trÃªn-python">4. Láº­p trÃ¬nh Collaborative Filtering trÃªn Python</h2>
<p>Trong bÃ y nÃ y, tÃ´i láº­p trÃ¬nh theo hÆ°á»›ng HÆ°á»›ng Äá»‘i TÆ°á»£ng cho class CF. <code class="language-plaintext highlighter-rouge">Class</code> nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng chung cho cáº£ User-user vÃ  Item-item CF. TrÆ°á»›c háº¿t, chÃºng ta sáº½ thá»­ nghiá»‡m vá»›i vÃ­ dá»¥ nhá» trong bÃ i, sau Ä‘Ã³ sáº½ Ã¡p dá»¥ng vÃ o bÃ i toÃ¡n vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u MovieLens.</p>

<p>DÆ°á»›i Ä‘Ã¢y lÃ  file <a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/24_collaborativefiltering/python/ex.dat"><code class="language-plaintext highlighter-rouge">ex.dat</code></a> mÃ´ táº£ dá»¯ liá»‡u Ä‘Ã£ biáº¿t cho vÃ­ dá»¥. Thá»© tá»± cá»§a ba cá»™t lÃ  <code class="language-plaintext highlighter-rouge">user_id</code>, <code class="language-plaintext highlighter-rouge">item_id</code>, vÃ  <code class="language-plaintext highlighter-rouge">rating</code>. VÃ­ dá»¥, hÃ ng Ä‘áº§u tiÃªn nghÄ©a lÃ  <code class="language-plaintext highlighter-rouge">u_0</code> rates <code class="language-plaintext highlighter-rouge">i_0</code> sá»‘ sao lÃ  <code class="language-plaintext highlighter-rouge">5</code>.</p>

<p>Khi lÃ m viá»‡c vá»›i Item-item CF, chÃºng ta chá»‰ cáº§n Ä‘á»•i vá»‹ trÃ­ cá»§a hai cá»™t Ä‘áº§u tiÃªn Ä‘á»ƒ nháº­n Ä‘Æ°á»£c ma tráº­n chuyá»ƒn vá»‹.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 0 5.
0 1 4.
0 3 2.
0 4 2.
1 0 5.
1 2 4.
1 3 2.
1 4 0.
2 0 2.
2 2 1.
2 3 3.
2 4 4.
3 0 0.
3 1 0.
3 3 4.
4 0 1.
4 3 4.
5 1 2.
5 2 1.
6 2 1.
6 3 4.
6 4 5.
</code></pre></div></div>

<p><a name="-class-cf"></a></p>

<h3 id="41-class-cf">4.1. <code class="language-plaintext highlighter-rouge">class CF</code></h3>

<p><strong>Khá»Ÿi táº¡o <code class="language-plaintext highlighter-rouge">class CF</code></strong></p>

<p>Dá»¯ liá»‡u Ä‘áº§u vÃ o cá»§a hÃ m khá»Ÿi táº¡o <code class="language-plaintext highlighter-rouge">class CF</code> lÃ  ma tráº­n Utility <code class="language-plaintext highlighter-rouge">Y_data</code> Ä‘Æ°á»£c lÆ°u dÆ°á»›i dáº¡ng má»™t ma tráº­n vá»›i 3 cá»™t, <code class="language-plaintext highlighter-rouge">k</code> lÃ  sá»‘ lÆ°á»£ng cÃ¡c Ä‘iá»ƒm lÃ¢n cáº­n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ dá»± Ä‘oÃ¡n káº¿t quáº£. <code class="language-plaintext highlighter-rouge">dist_func</code> lÃ  hÃ m Ä‘Ã³ <em>similarity</em> giá»¯a hai vectors, máº·c Ä‘á»‹nh lÃ  <code class="language-plaintext highlighter-rouge">cosine_similarity</code> Ä‘Æ°á»£c láº¥y tá»« <code class="language-plaintext highlighter-rouge">sklearn.metrics.pairwise</code>. Báº¡n Ä‘á»c cÅ©ng cÃ³ thá»ƒ thá»­ vá»›i cÃ¡c giÃ¡ trá»‹ <code class="language-plaintext highlighter-rouge">k</code> vÃ  hÃ m <code class="language-plaintext highlighter-rouge">dist_func</code> khÃ¡c nhau. Biáº¿n <code class="language-plaintext highlighter-rouge">uuCF</code> thá»ƒ hiá»‡n viá»‡c Ä‘ang sá»­ dá»¥ng User-user CF (1) hay Item-item CF(0).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span> 

<span class="k">class</span> <span class="nc">CF</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">"""docstring for CF"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">dist_func</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">,</span> <span class="n">uuCF</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">uuCF</span> <span class="o">=</span> <span class="n">uuCF</span> <span class="c1"># user-user (1) or item-item (0) CF
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span> <span class="o">=</span> <span class="n">Y_data</span> <span class="k">if</span> <span class="n">uuCF</span> <span class="k">else</span> <span class="n">Y_data</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="c1"># number of neighbor points
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">dist_func</span> <span class="o">=</span> <span class="n">dist_func</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">Ybar_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># number of users and items. Remember to add 1 since id starts from 0
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span> 
        <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div>

<p><strong>Khi cÃ³ dá»¯ liá»‡u má»›i, cáº­p nháº­n Utility matrix</strong> báº±ng cÃ¡ch thÃªm cÃ¡c hÃ ng nÃ y vÃ o cuá»‘i Utility Matrix. Äá»ƒ cho Ä‘Æ¡n giáº£n, giáº£ sá»­ ráº±ng khÃ´ng cÃ³ <em>users</em> hay <em>items</em> má»›i, cÅ©ng khÃ´ng cÃ³ <em>ratings</em> nÃ o bá»‹ thay Ä‘á»•i.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
        <span class="s">"""
        Update Y_data matrix when new ratings come.
        For simplicity, suppose that there is no new user or item.
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>TÃ­nh toÃ¡n normalized utility matrix vÃ  Similarity matrix</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">normalize_Y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># all users - first col of the Y_data
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">Ybar_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">):</span>
            <span class="c1"># row indices of rating done by user n
</span>            <span class="c1"># since indices need to be integers, we need to convert
</span>            <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">users</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="c1"># indices of all ratings associated with user n
</span>            <span class="n">item_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> 
            <span class="c1"># and the corresponding ratings 
</span>            <span class="n">ratings</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="c1"># take mean
</span>            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># to avoid empty array and nan value
</span>            <span class="c1"># normalize
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">Ybar_data</span><span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratings</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">mu</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

        <span class="c1">################################################
</span>        <span class="c1"># form the rating matrix as a sparse matrix. Sparsity is important 
</span>        <span class="c1"># for both memory and computing efficiency. For example, if #user = 1M, 
</span>        <span class="c1"># #item = 100k, then shape of the rating matrix would be (100k, 1M), 
</span>        <span class="c1"># you may not have enough memory to store this. Then, instead, we store 
</span>        <span class="c1"># nonzeros only, and, of course, their locations.
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">Ybar</span> <span class="o">=</span> <span class="n">sparse</span><span class="p">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">Ybar_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">Ybar_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">Ybar_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n_items</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">Ybar</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Ybar</span><span class="p">.</span><span class="n">tocsr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">dist_func</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">Ybar</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">Ybar</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Thá»±c hiá»‡n láº¡i 2 hÃ m phÃ­a trÃªn khi cÃ³ thÃªm dá»¯ liá»‡u</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Normalize data and calculate similarity matrix again (after
        some few ratings added)
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">normalize_Y</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">similarity</span><span class="p">()</span> 
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">refresh</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Dá»± Ä‘oÃ¡n káº¿t quáº£:</strong></p>

<p>HÃ m <code class="language-plaintext highlighter-rouge">__pred</code> lÃ  hÃ m dá»± Ä‘oÃ¡n <em>rating</em> mÃ  <em>user</em> <code class="language-plaintext highlighter-rouge">u</code> cho <em>item</em> <code class="language-plaintext highlighter-rouge">i</code> cho trÆ°á»ng há»£p User-user CF. VÃ¬ trong trÆ°á»ng há»£p Item-item CF, chÃºng ta cáº§n hiá»ƒu ngÆ°á»£c láº¡i nÃªn hÃ m <code class="language-plaintext highlighter-rouge">pred</code> sáº½ thá»±c hiá»‡n Ä‘á»•i vá»‹ trÃ­ hai biáº¿n cá»§a <code class="language-plaintext highlighter-rouge">__pred</code>. Äá»ƒ cho API Ä‘Æ°á»£c Ä‘Æ¡n giáº£n, tÃ´i cho <code class="language-plaintext highlighter-rouge">__pred</code> lÃ  má»™t phÆ°Æ¡ng thá»©c private, chá»‰ Ä‘Æ°á»£c gá»i trong <code class="language-plaintext highlighter-rouge">class CF</code>; <code class="language-plaintext highlighter-rouge">pred</code> lÃ  má»™t phÆ°Æ¡ng thá»©c public, thá»© tá»± cá»§a biáº¿n Ä‘áº§u vÃ o luÃ´n lÃ  (<em>user</em>, <em>item</em>), báº¥t ká»ƒ phÆ°Æ¡ng phÃ¡p sá»­ dá»¥ng lÃ  User-user CF hay Item-item CF.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">__pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="s">""" 
        predict the rating of user u for item i (normalized)
        if you need the un
        """</span>
        <span class="c1"># Step 1: find all users who rated i
</span>        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="c1"># Step 2: 
</span>        <span class="n">users_rated_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="mi">0</span><span class="p">]).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="c1"># Step 3: find similarity btw the current user and others 
</span>        <span class="c1"># who already rated i
</span>        <span class="n">sim</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">S</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">users_rated_i</span><span class="p">]</span>
        <span class="c1"># Step 4: find the k most similarity users
</span>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sim</span><span class="p">)[</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">:]</span> 
        <span class="c1"># and the corresponding similarity levels
</span>        <span class="n">nearest_s</span> <span class="o">=</span> <span class="n">sim</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="c1"># How did each of 'near' users rated item i
</span>        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Ybar</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">users_rated_i</span><span class="p">[</span><span class="n">a</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">normalized</span><span class="p">:</span>
            <span class="c1"># add a small number, for instance, 1e-8, to avoid dividing by 0
</span>            <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">nearest_s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">nearest_s</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">nearest_s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">nearest_s</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">mu</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
    
    
    <span class="k">def</span> <span class="nf">pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="s">""" 
        predict the rating of user u for item i (normalized)
        if you need the un
        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">uuCF</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__pred</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">normalize</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__pred</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">normalize</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>TÃ¬m táº¥t cáº£ cÃ¡c <em>items</em></strong> nÃªn Ä‘Æ°á»£c gá»£i Ã½ cho <em>user</em> <code class="language-plaintext highlighter-rouge">u</code> trong trÆ°á»ng há»£p User-user CF, hoáº·c tÃ¬m táº¥t cáº£ cÃ¡c <em>users</em> cÃ³ kháº£ nÄƒng thÃ­ch <em>item</em> <code class="language-plaintext highlighter-rouge">u</code> trong trÆ°á»ng há»£p Item-item CF</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="s">"""
        Determine all items should be recommended for user u. (uuCF =1)
        or all users who might have interest on item u (uuCF = 0)
        The decision is made based on all i such that:
        self.pred(u, i) &gt; 0. Suppose we are considering items which 
        have not been rated by u yet. 
        """</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">items_rated_by_u</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Y_data</span><span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="mi">1</span><span class="p">].</span><span class="n">tolist</span><span class="p">()</span>              
        <span class="n">recommended_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n_items</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">items_rated_by_u</span><span class="p">:</span>
                <span class="n">rating</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__pred</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rating</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                    <span class="n">recommended_items</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">recommended_items</span> 
</code></pre></div></div>

<p>In toÃ n bá»™ káº¿t quáº£:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">print_recommendation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        print all items which should be recommended for each user 
        """</span>
        <span class="k">print</span> <span class="s">'Recommendation: '</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">):</span>
            <span class="n">recommended_items</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">uuCF</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">'    Recommend item(s):'</span><span class="p">,</span> <span class="n">recommended_items</span><span class="p">,</span> <span class="s">'to user'</span><span class="p">,</span> <span class="n">u</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">print</span> <span class="s">'    Recommend item'</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">'to user(s) : '</span><span class="p">,</span> <span class="n">recommended_items</span>
</code></pre></div></div>

<p>Source code cho class nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m tháº¥y <a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/24_collaborativefiltering/python/CF.ipynb">á»Ÿ Ä‘Ã¢y</a>.</p>

<p><a name="-ap-dung-vao-vi-du"></a></p>

<h3 id="42-Ã¡p-dá»¥ng-vÃ o-vÃ­-dá»¥">4.2. Ãp dá»¥ng vÃ o vÃ­ dá»¥</h3>
<p>ChÃºng ta sáº½ thá»­ vá»›i User-user CF trÆ°á»›c:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># data file 
</span><span class="n">r_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'user_id'</span><span class="p">,</span> <span class="s">'item_id'</span><span class="p">,</span> <span class="s">'rating'</span><span class="p">]</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'ex.dat'</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">' '</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">r_cols</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">)</span>
<span class="n">Y_data</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">.</span><span class="n">as_matrix</span><span class="p">()</span>

<span class="n">rs</span> <span class="o">=</span> <span class="n">CF</span><span class="p">(</span><span class="n">Y_data</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">uuCF</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rs</span><span class="p">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">rs</span><span class="p">.</span><span class="n">print_recommendation</span><span class="p">()</span>
</code></pre></div></div>

<p>Káº¿t quáº£:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Recommendation: 
    Recommend item(s): [2] to user 0
    Recommend item(s): [1] to user 1
    Recommend item(s): [] to user 2
    Recommend item(s): [4] to user 3
    Recommend item(s): [4] to user 4
    Recommend item(s): [0, 3, 4] to user 5
    Recommend item(s): [1] to user 6
</code></pre></div></div>

<p>Vá»›i Item-item Collaborative Filtering:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rs</span> <span class="o">=</span> <span class="n">CF</span><span class="p">(</span><span class="n">Y_data</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">uuCF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">rs</span><span class="p">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">rs</span><span class="p">.</span><span class="n">print_recommendation</span><span class="p">()</span>
</code></pre></div></div>

<p>Káº¿t quáº£:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Recommendation: 
    Recommend item 0 to user(s) :  []
    Recommend item 1 to user(s) :  [1]
    Recommend item 2 to user(s) :  [0]
    Recommend item 3 to user(s) :  [5]
    Recommend item 4 to user(s) :  [3, 4, 5]
</code></pre></div></div>

<p><a name="-ap-dung-len-movielens-k"></a></p>

<h3 id="43-Ã¡p-dá»¥ng-lÃªn-movielens-100k">4.3. Ãp dá»¥ng lÃªn MovieLens 100k</h3>
<p>ChÃºng ta cÃ¹ng quay láº¡i lÃ m vá»›i <a href="/2017/05/17/contentbasedrecommendersys/#-bai-toan-voi-co-so-du-lieu-movielens-k">cÆ¡ sá»Ÿ dá»¯ liá»‡u MoiveLens 100k nhÆ° trong Content-based Recommendation Systems</a>. Nháº¯c láº¡i ráº±ng káº¿t quáº£ cá»§a phÆ°Æ¡ng phÃ¡p nÃ y cÃ³ trung bÃ¬nh lá»—i lÃ  1.2 sao vá»›i má»—i <em>rating</em>.</p>

<p>ChÃºng ta cÃ¹ng xem káº¿t quáº£ vá»›i User-user CF vÃ  Item-item CF.</p>

<p>TrÆ°á»›c háº¿t, ta cáº§n load dá»¯ liá»‡u.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'user_id'</span><span class="p">,</span> <span class="s">'movie_id'</span><span class="p">,</span> <span class="s">'rating'</span><span class="p">,</span> <span class="s">'unix_timestamp'</span><span class="p">]</span>

<span class="n">ratings_base</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'ml-100k/ub.base'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">r_cols</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">)</span>
<span class="n">ratings_test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'ml-100k/ub.test'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">r_cols</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">)</span>

<span class="n">rate_train</span> <span class="o">=</span> <span class="n">ratings_base</span><span class="p">.</span><span class="n">as_matrix</span><span class="p">()</span>
<span class="n">rate_test</span> <span class="o">=</span> <span class="n">ratings_test</span><span class="p">.</span><span class="n">as_matrix</span><span class="p">()</span>

<span class="c1"># indices start from 0
</span><span class="n">rate_train</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">rate_test</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></div>

<p><strong>Káº¿t quáº£ vá»›i User-user CF:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rs</span> <span class="o">=</span> <span class="n">CF</span><span class="p">(</span><span class="n">rate_train</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">uuCF</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rs</span><span class="p">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">n_tests</span> <span class="o">=</span> <span class="n">rate_test</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">SE</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># squared error
</span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_tests</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="n">pred</span><span class="p">(</span><span class="n">rate_test</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rate_test</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">normalized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">SE</span> <span class="o">+=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">-</span> <span class="n">rate_test</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> 

<span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SE</span><span class="o">/</span><span class="n">n_tests</span><span class="p">)</span>
<span class="k">print</span> <span class="s">'User-user CF, RMSE ='</span><span class="p">,</span> <span class="n">RMSE</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User-user CF, RMSE = 0.995198110088
</code></pre></div></div>

<p><strong>Káº¿t quáº£ vá»›i Item-item CF:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rs</span> <span class="o">=</span> <span class="n">CF</span><span class="p">(</span><span class="n">rate_train</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">uuCF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">rs</span><span class="p">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">n_tests</span> <span class="o">=</span> <span class="n">rate_test</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">SE</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># squared error
</span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_tests</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="n">pred</span><span class="p">(</span><span class="n">rate_test</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rate_test</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">normalized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">SE</span> <span class="o">+=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">-</span> <span class="n">rate_test</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> 

<span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SE</span><span class="o">/</span><span class="n">n_tests</span><span class="p">)</span>
<span class="k">print</span> <span class="s">'Item-item CF, RMSE ='</span><span class="p">,</span> <span class="n">RMSE</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Item-item CF, RMSE = 0.986791213271
</code></pre></div></div>

<p>Tá»« Ä‘Ã³ ta nháº­n tháº¥y Item-item CF cho lá»—i nhá» hÆ¡n (0.987) so vá»›i User-user CF (0.995) vÃ  tá»‘t hÆ¡n so vá»›i Content-based Recommendation Systems á»Ÿ bÃ i trÆ°á»›c (1.2).</p>

<p><em>CÃ¡c báº¡n cÅ©ng cÃ³ thá»ƒ thay _neighborhood size</em> <code class="language-plaintext highlighter-rouge">k</code> báº±ng cÃ¡c giÃ¡ trá»‹ khÃ¡c vÃ  so sÃ¡nh káº¿t quáº£._</p>

<p><a name="-thao-luan"></a></p>

<h2 id="5-tháº£o-luáº­n">5. Tháº£o luáº­n</h2>

<ul>
  <li>
    <p>Collaborative Filtering lÃ  má»™t phÆ°Æ¡ng phÃ¡p gá»£i Ã½ sáº£n pháº©m vá»›i Ã½ tÆ°á»Ÿng chÃ­nh dá»±a trÃªn cÃ¡c hÃ nh vi cá»§a cÃ¡c <em>users</em> khÃ¡c (collaborative) cÃ¹ng trÃªn má»™t <em>item</em> Ä‘á»ƒ suy ra má»©c Ä‘á»™ quan tÃ¢m (filtering) cá»§a má»™t <em>user</em> lÃªn sáº£n pháº©m. Viá»‡c suy ra nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n dá»±a trÃªn Similarity matrix Ä‘o Ä‘á»™ giá»‘ng nhau giá»¯a cÃ¡c <em>users</em>.</p>
  </li>
  <li>
    <p>Äá»ƒ tÃ­nh Ä‘Æ°á»£c Similarity matrix, trÆ°á»›c tiÃªn ta cáº§n chuáº©n hoÃ¡ dá»¯ liá»‡u. PhÆ°Æ¡ng phÃ¡p phá»• biáº¿n lÃ  <em>mean offset</em>, tá»©c trá»« cÃ¡c <em>ratings</em> Ä‘i giÃ¡ trá»‹ trung bÃ¬nh mÃ  má»™t <em>user</em> Ä‘Æ°a ra cho cÃ¡c _items.</p>
  </li>
  <li>
    <p>Similarity function thÆ°á»ng Ä‘Æ°á»£c dá»¥ng lÃ  <strong>Cosine similarity</strong> hoáº·c <strong>Pearson correlation</strong>.</p>
  </li>
  <li>
    <p>User-user CF cÃ³ má»™t vÃ i háº¡n cháº¿ khi lÆ°á»£ng <em>users</em> lÃ  lá»›n. Trong cÃ¡c trÆ°á»ng há»£p Ä‘Ã³, Item-item thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  cho káº¿t quáº£ tá»‘t hÆ¡n.</p>
  </li>
  <li>
    <p><a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/24_collaborativefiltering/python/CF.ipynb">Source code</a></p>
  </li>
</ul>

<p><a name="-tai-lieu-tham-khao"></a></p>

<h2 id="6-tÃ i-liá»‡u-tham-kháº£o">6. TÃ i liá»‡u tham kháº£o</h2>

<p>[1] <a href="http://infolab.stanford.edu/~ullman/mmds/ch9.pdf">Recommendation Systems - Stanford InfoLab</a></p>

<p>[2] <a href="https://www.youtube.com/watch?v=h9gpufJFF-0&amp;t=436s">Collaborative Filtering - Stanford University</a></p>

<p>[3] <a href="https://www.youtube.com/watch?v=saXRzxgFN0o&amp;list=PL_npY1DYXHPT-3dorG7Em6d18P4JRFDvH">Recommendation systems - Machine Learning - Andrew Ng</a></p>

<p>[4] Ekstrand, Michael D., John T. Riedl, and Joseph A. Konstan. â€œ<a href="http://herbrete.vvv.enseirb-matmeca.fr/IR/CF_Recsys_Survey.pdf">Collaborative filtering recommender systems.</a>â€ Foundations and TrendsÂ® in Humanâ€“Computer Interaction 4.2 (2011): 81-173.</p>

:ET